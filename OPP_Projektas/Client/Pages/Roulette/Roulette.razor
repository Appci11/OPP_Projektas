@*
Padariau atskira directory, nes planuoja but bent keli komponentai...
jei viskas i viena kruva eis... nu patys suprantam
PS. "@using blablabla"" galima i _Imports.razor det, tuomet visiem puslapiam galios
*@

@page "/roulette"
@inject NavigationManager NavigationManager
@implements IAsyncDisposable

<PageTitle>Roulette</PageTitle>
<h3>Roulette</h3>

@if (!IsConnected)
{
    <div class="input-group">
        <input @bind="username" class="form-control" placeholder="What's your name?">
        <button class="btn btn-primary form-control-append" @onclick="Connect">
            Connect
        </button>
    </div>
}
else
{
    <p>Place your bets : @betsTimer</p>
    <br />
    <ul id="messagesList">
        @foreach (var message in messages)
        {
            <li>@message</li>
        }
    </ul>
}

@code {
    private HubConnection? hubConnection;
    public bool IsConnected => hubConnection?.State == HubConnectionState.Connected;

    private string username = string.Empty;
    private int betsTimer = 0;

    private List<string> messages = new List<string>();

    private async Task Connect()
    {
        hubConnection = new HubConnectionBuilder()
            //jei nenorim nieko perduot tinka tiesiog kreiptis i hub'o endpoint'a
            //.WithUrl(NavigationManager.ToAbsoluteUri("/roulettehub"))
            //to pass smth query strings can be used
            .WithUrl(NavigationManager.ToAbsoluteUri($"/roulettehub?username={username}"))
            .Build();

        hubConnection.On<string>("GetThatMessage", (user) =>
        {
            var msg = user;
            if (messages.Count < 5)
            {
                messages.Add(msg);
            }
            else
            {
                messages.RemoveAt(0);
                messages.Add(msg);
            }
            //jei puslapyje kazkas kito, reiketu StateHasChanged() iskviest
            StateHasChanged();
        });

        hubConnection.On<int>("GetPlaceBetsTime", (time) =>
        {
            betsTimer = time;
            StateHasChanged();
        });


        //by default reikia, ne savo isgalvota
        await hubConnection.StartAsync();
    }

    //copy pasta default dispose...
    public async ValueTask DisposeAsync()
    {
        if (hubConnection != null)
        {
            await hubConnection.DisposeAsync();
        }
    }
}